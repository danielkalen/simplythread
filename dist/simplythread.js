var slice=[].slice;
(function(){var p,x,f,k,h,l,c,y,m,n,z,A;h=new function(){var a;a=[];this.create=function(b){b=new c(b);a.push(b);return b};this.remove=function(b){b=a.indexOf(b);if(-1!==b)return a.splice(b,1)};this.list=function(){return a.slice()};this.killAll=function(){a.slice().forEach(function(a){return a.kill()});return!0};return this};n=/^\s*function\s*\(\)\s*\{\s*([\w\W]+)\s*\}\s*$/;p=!!window.Worker&&!!window.Blob&&!!window.URL;x=!!window.Promise;f={string:!0,number:!0,"boolean":!0,symbol:!0};k={references:!0};
y=0;z=function(){return++y};m=function(){(function(a,b){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=b():"function"===typeof define&&define.amd?define(function(){return b()}):a.javascriptStringify=b()})(this,function(){function a(a){return f[a]||"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}function b(a){return"Function("+q("return this;")+")()"}function g(a){for(var b="",e=0;e<a.length;e++)var d=a[e],b=!k[d]&&m.test(d)?b+("."+a[e]):b+("["+
q(a[e])+"]");return b}function c(a,b,g){a=a.map(function(a,e){var d=g(a,e);return void 0===d?String(d):b+d.split("\n").join("\n"+b)}).join(b?",\n":",");return b&&a?"[\n"+a+"\n]":"["+a+"]"}function h(a){var b=String(a),e=Object.keys(a),d;if(d=e.length){for(b="var x="+b+";";d--;)b+="x['"+e[d]+"']="+q(a[e[d]])+";";return"(function(){"+b+"return x;}())"}return b}function q(a,b,g){if(Object(a)!==a)return p[typeof a](a,b,g);if("function"===typeof Buffer&&Buffer.isBuffer(a))return"new Buffer("+g(a.toString())+
")";var e=n[Object.prototype.toString.call(a)];return e?e(a,b,g):void 0}var l=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'",'"':'\\"',"\\":"\\\\"},k={};"break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" ").map(function(a){k[a]=
!0});var m=/^[A-Za-z_$][A-Za-z0-9_$]*$/,n={"[object Array]":c,"[object Object]":function(a,b,g){var e=Object.keys(a).reduce(function(e,d){var c=g(a[d],d);if(void 0===c)return e;d=!k[d]&&m.test(d)?d:q(d);c=String(c).split("\n").join("\n"+b);e.push(b+d+":"+(b?" ":"")+c);return e},[]).join(b?",\n":",");return b&&e?"{\n"+e+"\n}":"{"+e+"}"},"[object Date]":function(a){return"new Date("+a.getTime()+")"},"[object String]":function(a){return"new String("+q(a.toString())+")"},"[object Number]":function(a){return"new Number("+
a+")"},"[object Boolean]":function(a){return"new Boolean("+a+")"},"[object Uint8Array]":function(a,b){return"new Uint8Array("+c(a)+")"},"[object RegExp]":h,"[object Function]":h,"[object global]":b,"[object Window]":b},p={string:function(b){return"'"+b.replace(l,a)+"'"},number:String,object:String,"boolean":String,symbol:String,undefined:String};return function(a,b,c,d){function e(a,b){if(!l||void 0!==a){f.push(b);var c=u(a,q);f.pop();return c}}d=d||{};"string"!==typeof c&&(c=Array(Math.max(0,c|0)+
1).join(" "));var h=Number(d.maxDepth)||100,l=!!d.skipUndefinedProperties,k=Number(d.maxValues)||1E5,f=[],m=[],n=[],p=[],t=[],u=d.references?function(a,b){if(a&&("object"===typeof a||"function"===typeof a)){var d=n.indexOf(a);if(-1<d){t.push(f.slice(),p[d]);return}n.push(a);p.push(f.slice())}if(!(f.length>h||0>=k--))return b(a,c,e)}:function(a,b){if(!(-1<m.indexOf(a)||f.length>h||0>=k--))return m.push(a),a=b(a,c,e),m.pop(),a};if("function"===typeof b)var w=u,u=function(a,d){return w(a,function(a,
c,g){return b(a,c,function(a){return d(a,c,g)})})};var r=u(a,q);if(t.length){a=c?"\n":"";d=c?" = ":"=";for(var B=";"+a,w=c?"(function () {":"(function(){",r=["var x"+d+r],v=0;v<t.length;v+=2)r.push("x"+g(t[v])+d+"x"+g(t[v+1]));r.push("return x");return w+a+r.join(B)+B+"}())"}return r}})};c=function(a){var b,c;this.fn=a;this.fnString=null!=(b=this.fn)?b.toString():void 0;this.status="active";c=new l(this.fn,this.fnString);Object.defineProperty(this,"thread",{enumerable:!1,configurable:!1,get:function(){return c}});
return this};c.prototype.run=function(){var a;a=1<=arguments.length?slice.call(arguments,0):[];return"function"===typeof this.fn?this.thread.sendCommand("run",this._stringifyPayload(a)).then(function(a){return function(b){return a._parsePayload(b)}}(this))["catch"](function(a){return function(b){return Promise.reject(a._parseRejection(b))}}(this)):Promise.reject(Error("No function was set for this thread."))};c.prototype.on=function(a,b){if("string"===typeof a&&"function"===typeof b)return this.thread.socket.on(a,
function(a){return function(c){return b(a._parsePayload(c.payload))}}(this))};c.prototype.setFn=function(a,b){"function"===typeof a&&(this.fn=a,this.fnString=a.toString(),this.thread.sendCommand("setFn",this.fnString),b&&this.setContext(b));return this};c.prototype.setGlobals=function(a){this.thread.sendCommand("setGlobals",this._stringifyPayload(a));return this};c.prototype.setScripts=function(a){this.thread.sendCommand("setScripts",this._stringifyPayload([].concat(a)));return this};c.prototype.setContext=
function(a){this.thread.sendCommand("setContext",this._stringifyPayload(a));return this};c.prototype.kill=function(){var a;null!=(a=this.thread)&&a.worker.terminate();this.status="dead";h.remove(this);return this};c.prototype._stringifyPayload=function(a){var b;b={type:typeof a};b.data=f[b.type]?a:this.javascriptStringify(a,null,null,k);return b};c.prototype._parsePayload=function(a){return f[a.type]?a.data:eval("("+a.data+")")};c.prototype._parseRejection=function(a){var b;return(a=this._parsePayload(a))&&
"object"===typeof a&&window[a.name]&&window[a.name].constructor===Function?(b=a.name&&window[a.name]?new window[a.name](a.message):Error(a.message),b.stack=a.stack,b):a};m.call(c.prototype);l=function(a,b){this.fn=a;this.fnString=b;this.worker=this.init();this.socket=this.openSocket();this.fn&&this.sendCommand("setFn",this.fnString);return this};l.prototype.init=function(){return p?new Worker(this.createURI()):!1};l.prototype.createURI=function(){var a,b;b=A.toString().match(n)[1];a=m.toString().match(n)[1];
a+="var PRIMITIVE_TYPES = "+JSON.stringify(f)+";";a+="var STRINGIFY_OPTS = "+JSON.stringify(k)+";";x||(a+='(function(){"use strict";var f,g=[];function l(a){g.push(a);1==g.length&&f()}function m(){for(;g.length;)g[0](),g.shift()}f=function(){setTimeout(m)};function n(a){this.a=p;this.b=void 0;this.f=[];var b=this;try{a(function(a){q(b,a)},function(a){r(b,a)})}catch(c){r(b,c)}}var p=2;function t(a){return new n(function(b,c){c(a)})}function u(a){return new n(function(b){b(a)})}function q(a,b){if(a.a==p){if(b==a)throw new TypeError;var c=!1;try{var d=b&&b.then;if(null!=b&&"object"==typeof b&&"function"==typeof d){d.call(b,function(b){c||q(a,b);c=!0},function(b){c||r(a,b);c=!0});return}}catch(e){c||r(a,e);return}a.a=0;a.b=b;v(a)}} function r(a,b){if(a.a==p){if(b==a)throw new TypeError;a.a=1;a.b=b;v(a)}}function v(a){l(function(){if(a.a!=p)for(;a.f.length;){var b=a.f.shift(),c=b[0],d=b[1],e=b[2],b=b[3];try{0==a.a?"function"==typeof c?e(c.call(void 0,a.b)):e(a.b):1==a.a&&("function"==typeof d?e(d.call(void 0,a.b)):b(a.b))}catch(h){b(h)}}})}n.prototype.g=function(a){return this.c(void 0,a)};n.prototype.c=function(a,b){var c=this;return new n(function(d,e){c.f.push([a,b,d,e]);v(c)})}; function w(a){return new n(function(b,c){function d(c){return function(d){h[c]=d;e+=1;e==a.length&&b(h)}}var e=0,h=[];0==a.length&&b(h);for(var k=0;k<a.length;k+=1)u(a[k]).c(d(k),c)})}function x(a){return new n(function(b,c){for(var d=0;d<a.length;d+=1)u(a[d]).c(b,c)})};self.Promise||(self.Promise=n,self.Promise.resolve=u,self.Promise.reject=t,self.Promise.race=x,self.Promise.all=w,self.Promise.prototype.then=n.prototype.c,self.Promise.prototype["catch"]=n.prototype.g);}());');
a=new Blob([a+b],{type:"application/javascript"});return URL.createObjectURL(a)};l.prototype.openSocket=function(){this.worker&&this.worker.addEventListener("message",function(a){return function(b){if(b.data.ID&&a.socket.callbacks[b.data.ID])return a.socket.callbacks[b.data.ID](b.data)}}(this));return{on:function(a,b){return this.callbacks[a]=b},callbacks:{}}};l.prototype.sendCommand=function(a,b){return new Promise(function(c){return function(f,h){var g;if(c.worker){if("run"===a)c.socket.on(g=z(),
function(a){switch(a.status){case "resolve":return f(a.payload);case "reject":return h(a.payload)}});return c.worker.postMessage({command:a,payload:b,ID:g})}switch(a){case "run":if(c.fn)return c.fn.apply(c.context,b);break;case "setFn":if("function"===typeof b)return c.fn=eval("("+b.toString()+")");break;case "setContext":return c.context=b}}}(this))};A=function(){Promise.resolve()};h.version="1.7.0";return null!=("undefined"!==typeof exports&&null!==exports?exports.module:void 0)?module.exports=
h:"function"===typeof define&&define.amd?define(["simplythread"],function(){return h}):this.SimplyThread=h})();
