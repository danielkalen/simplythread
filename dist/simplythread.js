var slice=[].slice;
(function(){var z,w,A,u,p,k,B,C,d,D,E;p=new function(){var a;a=[];this.create=function(b){b=new k(b);a.push(b);return b};this.remove=function(b){b=a.indexOf(b);return a.splice(b,1)};this.list=function(){return a.slice()};this.killAll=function(){a.slice().forEach(function(a){return a.kill()});return!0};return this};k=function(a){this.fn=a;this.status="active";this.worker=function(a){return function(){return u.workers?d.patchWorkerMethods(new Worker(d.createWorkerURI())):new z}}(this)();this.socket=
function(a){return function(){a.worker.addEventListener("message",function(b){if(b.ID&&a.socket.callbacks[b.ID])return a.socket.callbacks[b.ID](b)});return{on:function(a,b){return this.callbacks[a]=b},callbacks:{}}}}(this)();this.fn&&this.setFn(this.fn);return this};k.prototype.run=function(){var a;a=1<=arguments.length?slice.call(arguments,0):[];return"function"===typeof this.fn?new Promise(function(b){return function(m,f){var g;b.socket.on(g=d.genTransactionID(),function(a){switch(a.status){case "resolve":return m(a.payload);
case "reject":return f(a.payload)}});return b.worker.postMessage({command:"run",payload:a,ID:g})}}(this)):Promise.reject(Error("No function was set for this thread."))};k.prototype.on=function(a,b){if("function"!==typeof b)throw Error("Provided callback isn't a function");return this.socket.on(a,function(a){return b(a.payload)})};k.prototype.setFn=function(a,b){if("function"!==typeof a)throw Error("Provided argument isn't a function");this.fn=a;this.fnString=a.toString();this.worker.postMessage({command:"setFn",
payload:this.fnString},!1);null!=b&&this.setContext(b);return this};k.prototype.setGlobals=function(a){if(a&&"object"===typeof a)this.worker.postMessage({command:"setGlobals",payload:a});else throw Error("Provided argument isn't an object");return this};k.prototype.setScripts=function(a){this.worker.postMessage({command:"setScripts",payload:[].concat(a)});return this};k.prototype.setContext=function(a){this.worker.postMessage({command:"setContext",payload:a});return this};k.prototype.kill=function(){this.worker.terminate();
this.status="dead";p.remove(this);return this};E=function(){var a;a=eval;(function(){var b,m,f,g,l,q,k,r,t;b=m=null;f=Promise.resolve();t=function(a){var b,c,e;c=a.name;b=a.message;e=a.stack;return c?d.stringifyPayload({name:c,message:b,stack:e}):d.stringifyPayload(a)};g=function(a){return new Promise(function(b,c){var e;e=new XMLHttpRequest;e.open("GET",a,!0);e.onerror=c;e.onload=function(){var a;return 200>=(a=this.status)&&400>a?b(this.response):c(Error("External fetch failed (status:"+e.status+
"): "+e.response))};return e.send()})};l=function(b){var h,c;c=b.split("#")[0];h=b.split("#")[1]||c;c=c.replace(/\//g,"%2F");return g("https://wzrd.in/bundle/"+c).then(function(b){if(b)return b=a(b),self[h]=b(c)})};k=function(a){var b,c;for(b in a)c=a[b],self[b]=c};r=function(b){return f=new Promise(function(h,c){var e,n,v,d,f;e=0;n=function(n){return function(){switch(typeof n){case "function":return Promise.resolve(n.call(self));case "string":return"MODULE:"===n.slice(0,7)?l(n.slice(7)):g(n).then(function(c){if(c)return a("("+
c+")")});default:return Promise.resolve()}}().then(function(){if(++e===b.length)return h()})["catch"](c)};v=0;for(d=b.length;v<d;v++)f=b[v],n(f)})};q=function(a,h){null==h&&(h=[]);return f.then(function(){var c,e;try{e=m.apply(b,h)}catch(n){postMessage({ID:a,status:"reject",payload:t(n)}),c=!0}if(!c)return Promise.resolve(e).then(function(c){return postMessage({ID:a,status:"resolve",payload:d.stringifyPayload(c)})})["catch"](function(c){return postMessage({ID:a,status:"reject",payload:d.stringifyPayload(c)})})})["catch"](function(c){return postMessage({ID:a,
status:"reject",payload:t(c)})})};return this.onmessage=function(f){var h,c;h=f.data.command;c=f.data.payload;f=f.data.ID;switch(h){case "setGlobals":return k(d.parsePayload(c));case "setScripts":return r(d.parsePayload(c));case "setContext":return b=d.parsePayload(c);case "setFn":return m=a("("+c+")");case "run":return q(f,d.parsePayload(c))}}})()};z=function(){var a,b,m,f,g,l,q,k,r,t,p;this.isAlive=!0;a=b=this.messageCallback=null;m="";f=Promise.resolve();(function(a){return function(a,b){return q({ID:a,
payload:b})}})(this);q=function(a){return function(c){return a.messageCallback(c)}}(this);g=function(a){return new Promise(function(c,b){var e;e=new XMLHttpRequest;e.open("GET",a,!0);e.onerror=b;e.onreadystatechange=function(){var a;if(4===this.readyState)return 200>=(a=this.status)&&400>a?c(this.responseText):b(Error("External fetch failed (status:"+this.status+"): "+this.responseText))};return e.send()})};l=function(a){var c,b;b=a.split("#")[0];c=a.split("#")[1]||b;b=b.replace(/\//g,"%2F");return g("https://wzrd.in/bundle/"+
b).then(function(a){if(a)return a=a.slice(0,-1),m+="var "+c+" = ("+a+")('"+b+"');",r()})};r=function(a){null==a&&(a=b.toString());return b=eval(m+" ("+a+")")};t=function(a){m+=d.stringifyAsGlobals(a);r()};p=function(a){return f=new Promise(function(c){return function(c,b){var e,n,f,d,h;n=e=0;for(f=a.length;n<f;n++)d=a[n],h=function(){switch(typeof d){case "function":return Promise.resolve(d.call(self));case "string":return"MODULE:"===d.slice(0,7)?l(d.slice(7)):g(d).then(function(a){if(a)return eval("("+
a+")")});default:return Promise.resolve()}}(),h.then(function(){if(++e===a.length)return c()})["catch"](b)}}(this))};k=function(d,c){null==c&&(c=[]);return f.then(function(e){return function(){var e,f;try{f=b.apply(a,c)}catch(F){q({ID:d,status:"reject",payload:F}),e=!0}if(!e)return Promise.resolve(f).then(function(a){return q({ID:d,status:"resolve",payload:a})})["catch"](function(a){return q({ID:d,status:"reject",payload:a})})}}(this))["catch"](function(a){return function(a){return q({ID:d,status:"reject",
payload:a})}}(this))};this.onmessage=function(b){var c,e;c=b.command;e=b.payload;b=b.ID;switch(c){case "setGlobals":return t(e);case "setScripts":return p(e);case "setContext":return a=e;case "setFn":return r(e);case "run":return k(b,e)}};return this};z.prototype={addEventListener:function(a,b){if(this.isAlive)return this.messageCallback=b},postMessage:function(a){if(this.isAlive)return this.onmessage(a)},terminate:function(){return this.isAlive=!1}};d={};B=0;d.genTransactionID=function(){return++B};
d.extend=function(a,b,d){var f,g,l,m;l=Object.keys(b);f=0;for(m=l.length;f<m;f++)g=l[f],g!==d&&(a[g]=b[g]);return a};d.createWorkerURI=function(){var a,b;b=E.toString().match(C)[1];a=p.threadDeps||"";a+="var helpers="+d.javascriptStringify(d.extend({},d,"javascriptStringify"))+"; helpers.exposeStringifyFn();";a+="var PRIMITIVE_TYPES = "+JSON.stringify(w)+";";a+="var STRINGIFY_OPTS = "+JSON.stringify(A)+";";u.promises||(a+=D);a=new Blob([a+b],{type:"application/javascript"});return(window.URL||window.webkitURL).createObjectURL(a)};
d.patchWorkerMethods=function(a){var b,m;m=a.postMessage.bind(a);a.postMessage=function(a,b){null==b&&(b=!0);b&&(a.payload=d.stringifyPayload(a.payload));return m(a)};b=a.addEventListener.bind(a);a.addEventListener=function(a,g){return b(a,function(a){var b;a.data.payload&&(b="reject"===a.data.status?"parseRejection":"parsePayload",a.data.payload=d[b](a.data.payload));return g(a.data)})};return a};d.stringifyAsGlobals=function(a){var b,d,f,g,l,k;b="";l=Object.keys(a);f=d=0;for(k=l.length;d<k;f=++d)g=
l[f],b+=g+"="+this.javascriptStringify(a[g])+(f===l.length-1?";":",")+" ";return b?"var "+b:b};d.stringifyPayload=function(a){var b;b={type:typeof a};b.data=w[b.type]?a:this.javascriptStringify(a,null,null,A);return b};d.parsePayload=function(a){return w[a.type]?a.data:eval("("+a.data+")")};d.parseRejection=function(a){var b;return(a=this.parsePayload(a))&&"object"===typeof a&&window[a.name]&&window[a.name].constructor===Function?(b=new window[a.name](a.message),b.stack=a.stack,b):a};d.exposeStringifyFn=
function(){(function(a,b){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=b():"function"===typeof define&&define.amd?define(function(){return b()}):a.javascriptStringify=b()})(this,function(){function a(a){return p[a]||"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}function b(a){return"Function("+l("return this;")+")()"}function d(a){for(var b="",c=0;c<a.length;c++)var d=a[c],b=!r[d]&&t.test(d)?b+("."+a[c]):b+("["+l(a[c])+"]");return b}function f(a,
b,d){a=a.map(function(a,c){var e=d(a,c);return void 0===e?String(e):b+e.split("\n").join("\n"+b)}).join(b?",\n":",");return b&&a?"[\n"+a+"\n]":"["+a+"]"}function g(a){var b=String(a),c=Object.keys(a),d;if(d=c.length){for(b="var x="+b+";";d--;)b+="x['"+c[d]+"']="+l(a[c[d]])+";";return"(function(){"+b+"return x;}())"}return b}function l(a,b,d){if(Object(a)!==a)return h[typeof a](a,b,d);if("function"===typeof Buffer&&Buffer.isBuffer(a))return"new Buffer("+d(a.toString())+")";var c=u[Object.prototype.toString.call(a)];
return c?c(a,b,d):void 0}var k=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'",'"':'\\"',"\\":"\\\\"},r={};"break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" ").map(function(a){r[a]=
!0});var t=/^[A-Za-z_$][A-Za-z0-9_$]*$/,u={"[object Array]":f,"[object Object]":function(a,b,d){var c=Object.keys(a).reduce(function(c,e){var f=d(a[e],e);if(void 0===f)return c;e=!r[e]&&t.test(e)?e:l(e);f=String(f).split("\n").join("\n"+b);c.push(b+e+":"+(b?" ":"")+f);return c},[]).join(b?",\n":",");return b&&c?"{\n"+c+"\n}":"{"+c+"}"},"[object Date]":function(a){return"new Date("+a.getTime()+")"},"[object String]":function(a){return"new String("+l(a.toString())+")"},"[object Number]":function(a){return"new Number("+
a+")"},"[object Boolean]":function(a){return"new Boolean("+a+")"},"[object Uint8Array]":function(a,b){return"new Uint8Array("+f(a)+")"},"[object RegExp]":g,"[object Function]":g,"[object global]":b,"[object Window]":b},h={string:function(b){return"'"+b.replace(k,a)+"'"},number:String,object:String,"boolean":String,symbol:String,undefined:String};return function(a,b,f,g){function c(a,b){if(!k||void 0!==a){h.push(b);var c=t(a,l);h.pop();return c}}g=g||{};"string"!==typeof f&&(f=Array(Math.max(0,f|0)+
1).join(" "));var e=Number(g.maxDepth)||100,k=!!g.skipUndefinedProperties,m=Number(g.maxValues)||1E5,h=[],n=[],p=[],r=[],q=[],t=g.references?function(a,b){if(a&&("object"===typeof a||"function"===typeof a)){var d=p.indexOf(a);if(-1<d){q.push(h.slice(),r[d]);return}p.push(a);r.push(h.slice())}if(!(h.length>e||0>=m--))return b(a,f,c)}:function(a,b){if(!(-1<n.indexOf(a)||h.length>e||0>=m--))return n.push(a),a=b(a,f,c),n.pop(),a};if("function"===typeof b)var u=t,t=function(a,c){return u(a,function(a,
d,e){return b(a,d,function(a){return c(a,d,e)})})};var x=t(a,l);if(q.length){a=f?"\n":"";g=f?" = ":"=";for(var w=";"+a,u=f?"(function () {":"(function(){",x=["var x"+g+x],v=0;v<q.length;v+=2)x.push("x"+d(q[v])+g+"x"+d(q[v+1]));x.push("return x");return u+a+x.join(w)+w+"}())"}return x}})};d.exposeStringifyFn();C=/^\s*function\s*\(\)\s*\{\s*([\w\W]+)\s*\}\s*$/;u=p.SUPPORTS={};u.promises=!!window.Promise;var G=u,y;if(y=!!window.Worker&&!!window.Blob&&(!!window.URL||!!window.webkitURL))a:{try{(new Worker(d.createWorkerURI())).terminate();
y=!0;break a}catch(a){}y=void 0}G.workers=y;w={string:!0,number:!0,"boolean":!0,symbol:!0};A={references:!0};D='(function(){"use strict";var f,g=[];function l(a){g.push(a);1==g.length&&f()}function m(){for(;g.length;)g[0](),g.shift()}f=function(){setTimeout(m)};function n(a){this.a=p;this.b=void 0;this.f=[];var b=this;try{a(function(a){q(b,a)},function(a){r(b,a)})}catch(c){r(b,c)}}var p=2;function t(a){return new n(function(b,c){c(a)})}function u(a){return new n(function(b){b(a)})}function q(a,b){if(a.a==p){if(b==a)throw new TypeError;var c=!1;try{var d=b&&b.then;if(null!=b&&"object"==typeof b&&"function"==typeof d){d.call(b,function(b){c||q(a,b);c=!0},function(b){c||r(a,b);c=!0});return}}catch(e){c||r(a,e);return}a.a=0;a.b=b;v(a)}} function r(a,b){if(a.a==p){if(b==a)throw new TypeError;a.a=1;a.b=b;v(a)}}function v(a){l(function(){if(a.a!=p)for(;a.f.length;){var b=a.f.shift(),c=b[0],d=b[1],e=b[2],b=b[3];try{0==a.a?"function"==typeof c?e(c.call(void 0,a.b)):e(a.b):1==a.a&&("function"==typeof d?e(d.call(void 0,a.b)):b(a.b))}catch(h){b(h)}}})}n.prototype.g=function(a){return this.c(void 0,a)};n.prototype.c=function(a,b){var c=this;return new n(function(d,e){c.f.push([a,b,d,e]);v(c)})}; function w(a){return new n(function(b,c){function d(c){return function(d){h[c]=d;e+=1;e==a.length&&b(h)}}var e=0,h=[];0==a.length&&b(h);for(var k=0;k<a.length;k+=1)u(a[k]).c(d(k),c)})}function x(a){return new n(function(b,c){for(var d=0;d<a.length;d+=1)u(a[d]).c(b,c)})};self.Promise||(self.Promise=n,self.Promise.resolve=u,self.Promise.reject=t,self.Promise.race=x,self.Promise.all=w,self.Promise.prototype.then=n.prototype.c,self.Promise.prototype["catch"]=n.prototype.g);}());';
p.version="2.0.2";return null!=("undefined"!==typeof exports&&null!==exports?exports.module:void 0)?module.exports=p:"function"===typeof define&&define.amd?define(["simplythread"],function(){return p}):this.SimplyThread=p})();
