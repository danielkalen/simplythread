var slice=[].slice;!function(){var SimplyThread,Thread,ThreadInterface,promisePolyfill,supports,workerScript,workerScriptRegEx;return supports={workers:!!window.Worker&&!!window.Blob&&!!window.URL,promises:!!window.Promise},SimplyThread=new function(){var t;return t=[],this.create=function(e){var n;return n=new ThreadInterface(e),t.push(n),n},this.remove=function(e){var n;return n=t.indexOf(e),-1!==n?t.splice(n,1):void 0},this.list=function(){return t.slice()},this.killAll=function(){return t.forEach(function(t){return t.kill()}),this.list()},this},ThreadInterface=function(t){var e,n;return this.fn=t,this.fnString=null!=(e=this.fn)?e.toString():void 0,this.status="active",n=new Thread(this.fn,this.fnString),Object.defineProperty(this,"thread",{enumerable:!1,configurable:!1,get:function(){return n}}),this},ThreadInterface.prototype.run=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],new Promise(function(e){return function(n,r){return"function"==typeof e.fn?e.thread.sendCommand("run",t).then(n,r):r(new Error("No function was set for this thread."))}}(this))},ThreadInterface.prototype.setFn=function(t,e){return"function"==typeof t&&(this.fn=t,this.fnString=t.toString(),this.thread.sendCommand("setFn",this.fnString),this.setContext(e)),this},ThreadInterface.prototype.setContext=function(t){var e,n;try{e=JSON.stringify(t)}catch(n){e=function(){var e,n;return e=[],n=JSON.stringify(t,function(n,r){if(null!==r&&"object"==typeof r){if(-1!==e.indexOf(r))return r===t?"**_circular_**":(null!=r?r.nodeName:void 0)&&r.nodeType?r:void 0;e.push(r)}return r}),e=null,n}()}return this.thread.sendCommand("setContext",e),this},ThreadInterface.prototype.kill=function(){var t;return null!=(t=this.thread)&&t.worker.terminate(),this.status="dead",SimplyThread.remove(this),this},Thread=function(t,e){return this.fn=t,this.fnString=e,this.worker=this.init(),this.fn&&this.sendCommand("setFn",this.fnString),this},Thread.prototype.init=function(){return supports.workers?new Worker(this.createURI()):!1},Thread.prototype.createURI=function(){var t,e;return e=workerScript.toString().match(workerScriptRegEx)[1],supports.promises||(e+=promisePolyfill),t=new Blob([e],{type:"application/javascript"}),URL.createObjectURL(t)},Thread.prototype.sendCommand=function(t,e){return new Promise(function(n){return function(r,o){var i;if(n.worker)return i=function(t){switch(t.data.status){case"resolve":r(t.data.payload);break;case"reject":o(t.data.payload)}return n.worker.removeEventListener("message",i)},"run"===t&&n.worker.addEventListener("message",i),n.worker.postMessage({command:t,payload:e});switch(t){case"run":if(n.fn)return n.fn.apply(n.context,e);break;case"setFn":if("function"==typeof e)return n.fn=e;break;case"setContext":return n.context=e}}}(this))},workerScriptRegEx=/^\s*function\s*\(\)\s*\{\s*([\w\W]+)\s*\}\s*$/,workerScript=function(){var circularReference,fnContext,fnToExecute,onmessage,run,setContext,setFn;fnToExecute=function(){},fnContext=null,circularReference="**_circular_**",onmessage=function(t){var e,n;switch(e=t.data.command,n=t.data.payload,e){case"setContext":return setContext(n);case"setFn":return setFn(n);case"run":return run(n)}},setContext=function(t){return"object"==typeof t?fnContext=t:(t=JSON.parse(t),fnContext=setContext.replaceCircular(t,t))},setContext.replaceCircular=function(t,e){var n,r;for(n in t)r=t[n],r===circularReference?t[n]=e:"object"!=typeof r||Array.isArray(r)||(t[n]=setContext.replaceCircular(r,t));return t},setFn=function(fnString){return eval("fnToExecute = "+fnString)},run=function(t){var e,n,r,o;null==t&&(t=[]);try{o=fnToExecute.apply(fnContext,t)}catch(n){e=n,postMessage({status:"reject",payload:e.name+": "+e.message}),r=!0}return r?void 0:o&&o.then?(o.then(function(t){return postMessage({status:"resolve",payload:t})}),o["catch"](function(t){return postMessage({status:"reject",payload:t})})):postMessage({status:"resolve",payload:o})}},promisePolyfill='(function(){"use strict";var f,g=[];function l(a){g.push(a);1==g.length&&f()}function m(){for(;g.length;)g[0](),g.shift()}f=function(){setTimeout(m)};function n(a){this.a=p;this.b=void 0;this.f=[];var b=this;try{a(function(a){q(b,a)},function(a){r(b,a)})}catch(c){r(b,c)}}var p=2;function t(a){return new n(function(b,c){c(a)})}function u(a){return new n(function(b){b(a)})}function q(a,b){if(a.a==p){if(b==a)throw new TypeError;var c=!1;try{var d=b&&b.then;if(null!=b&&"object"==typeof b&&"function"==typeof d){d.call(b,function(b){c||q(a,b);c=!0},function(b){c||r(a,b);c=!0});return}}catch(e){c||r(a,e);return}a.a=0;a.b=b;v(a)}} function r(a,b){if(a.a==p){if(b==a)throw new TypeError;a.a=1;a.b=b;v(a)}}function v(a){l(function(){if(a.a!=p)for(;a.f.length;){var b=a.f.shift(),c=b[0],d=b[1],e=b[2],b=b[3];try{0==a.a?"function"==typeof c?e(c.call(void 0,a.b)):e(a.b):1==a.a&&("function"==typeof d?e(d.call(void 0,a.b)):b(a.b))}catch(h){b(h)}}})}n.prototype.g=function(a){return this.c(void 0,a)};n.prototype.c=function(a,b){var c=this;return new n(function(d,e){c.f.push([a,b,d,e]);v(c)})}; function w(a){return new n(function(b,c){function d(c){return function(d){h[c]=d;e+=1;e==a.length&&b(h)}}var e=0,h=[];0==a.length&&b(h);for(var k=0;k<a.length;k+=1)u(a[k]).c(d(k),c)})}function x(a){return new n(function(b,c){for(var d=0;d<a.length;d+=1)u(a[d]).c(b,c)})};window.Promise||(window.Promise=n,window.Promise.resolve=u,window.Promise.reject=t,window.Promise.race=x,window.Promise.all=w,window.Promise.prototype.then=n.prototype.c,window.Promise.prototype["catch"]=n.prototype.g);}());',window.SimplyThread=SimplyThread}();